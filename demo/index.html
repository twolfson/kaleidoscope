<!DOCTYPE html>
<html>

  <head lang="en">
    <meta charset="utf-8">
    <title>Custom Plunker</title>
    <style>
      body {
        background: #BADA55;
      }
    </style>
  </head>

  <body>
    <script src="iframe2image.withdomvas.js"></script>
    <canvas id="canvas"></canvas>
    <script>
      function createSnapshot(options, cb) {
        // Fallback options to a flat URL
        var url = options.url || options;

        // Create an iframe for drawing
        var iframe = document.createElement('iframe'),
            body = document.body;

        // Expand it out to 100%
        // TODO: Expand even bigger?
        iframe.height = 700;
        iframe.width = 700;
        iframe.style.cssText = 'display: none;';

        // Append the iframe to the DOM
        body.appendChild(iframe);

        // Load the url within the iframe
        iframe.setAttribute('src', url);

        // Convert the item to an image
        iframe2image(iframe, function (err, img) {
          // Remove the iframe
          body.removeChild(iframe);

          // Callback with result
          return cb.apply(this, arguments);
        });
      }
    </script>
    <script>
      // Set up the canvas dimensions
      var canvas = document.getElementById('canvas'),
          context = canvas.getContext('2d');
      canvas.width = 500;
      canvas.height = 600;

      // Get the image
      createSnapshot('inner.html', function (err, img) {
        // If there is an error, log it
        if (err) { return console.error(err); }

        // Otherwise, add the image to the canvas
        context.drawImage(img, 0, 0);
      });
    </script>

    <script src="watcher.js"></script>
    <script src="collector.js"></script>
    <script>
        (function () {
           var watcher = new FileWatcher(),
               resources = ResourceCollector.collect();
           watcher.addListener(function () {
             location.reload();
           });
           watcher.watch(resources);
        }());
    </script>
  </body>

</html>